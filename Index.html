<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Save Earth - Prathamer's Blog</title>
    
    <!-- 1. Google Search Console Verification -->
    <meta name="google-site-verification" content="t4ZUZByGtlSHwWKLBuQLOL4b3yMbVrLNxTzP8Okd850" />

    <!-- 2. Standard SEO Meta Tags -->
    <meta name="description" content="Save Earth: There is No Planet B - Read insights on environment, sustainability, and personal growth on Prathamer's Blog.">
    <meta name="keywords" content="save earth, environment, climate change, sustainability, blog, prathamer, trending posts">
    <meta name="author" content="Prathamer's Blog">
    <meta name="robots" content="index, follow">

    <!-- 3. Performance Optimization -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://images.unsplash.com">
    <link rel="preconnect" href="https://ui-avatars.com">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        h1, h2, h3, h4 { font-family: 'Merriweather', serif; }
        /* Custom Scrollbar for Trending Section */
        .trending-scroll::-webkit-scrollbar { width: 4px; }
        .trending-scroll::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 4px; }
        .trending-scroll::-webkit-scrollbar-thumb:hover { background: #d1d5db; }
        
        /* Smooth scrolling for the whole page */
        html { scroll-behavior: smooth; }
        
        /* Animation for content switching */
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-stone-50 text-stone-800 min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white border-b border-stone-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between gap-4">
            <!-- Logo -->
            <div class="flex items-center gap-2 flex-shrink-0 cursor-pointer" onclick="window.location.reload()">
                <i class="ph-fill ph-plant text-green-600 text-2xl"></i>
                <span class="font-bold text-xl tracking-tight hidden sm:block">Prathamer's Blog</span>
            </div>

            <!-- Search Bar -->
            <div class="flex-grow max-w-md relative">
                <input type="text" id="search-input" placeholder="Search trending topics..." class="w-full pl-10 pr-4 py-2 bg-stone-100 border-none rounded-full text-sm focus:ring-2 focus:ring-green-500 outline-none transition-all placeholder-stone-400">
                <i class="ph-bold ph-magnifying-glass absolute left-3 top-2.5 text-stone-400"></i>
            </div>

            <!-- Nav Links -->
            <nav class="flex gap-4 text-sm font-medium text-stone-500">
                <a href="#" onclick="window.location.reload()" class="hover:text-green-700 transition hidden sm:block">Home</a>
                <a href="#discussion" class="hover:text-green-700 transition flex items-center gap-1">
                    <i class="ph-bold ph-chat-circle-text text-green-600"></i> <span class="hidden sm:inline">Discuss</span>
                </a>
            </nav>
        </div>
    </header>

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto px-4 py-8 flex-grow w-full">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12">
            
            <!-- LEFT COLUMN: Main Article (8 cols) -->
            <main class="lg:col-span-8 order-1">
                <article class="bg-white p-6 sm:p-10 rounded-2xl shadow-sm border border-stone-100" id="main-article">
                    <header class="mb-8 text-center">
                        <span id="article-category" class="bg-green-100 text-green-800 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide mb-4 inline-block">Environment</span>
                        <h1 id="article-title" class="text-3xl md:text-5xl font-bold text-gray-900 mb-4 leading-tight">Save Earth: There is No Planet B</h1>
                        
                        <div class="flex flex-wrap items-center justify-center gap-4 text-sm text-stone-500 mt-6">
                            <div class="flex items-center gap-2">
                                <img id="article-author-img" src="https://ui-avatars.com/api/?name=Prathamer&background=16a34a&color=fff" class="w-8 h-8 rounded-full">
                                <span id="article-author" class="font-medium text-gray-900">Prathamer</span>
                            </div>
                            <span class="hidden sm:inline">•</span>
                            <span id="article-date">Oct 24, 2023</span>
                            <span class="hidden sm:inline">•</span>
                            <div class="flex items-center gap-1 text-green-600 font-bold bg-green-50 px-2 py-1 rounded">
                                <i class="ph-bold ph-eye"></i>
                                <span id="view-counter">...</span>
                            </div>
                        </div>
                    </header>

                    <!-- Featured Image -->
                    <div class="rounded-xl overflow-hidden shadow-md mb-10 aspect-video bg-stone-200">
                        <img id="article-image" src="https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-1.2.1&auto=format&fit=crop&w=1600&q=80" alt="Article Image" class="w-full h-full object-cover transition-transform duration-700 hover:scale-105">
                    </div>

                    <!-- Article Body -->
                    <div id="article-content" class="prose prose-lg prose-stone mx-auto text-gray-700 leading-relaxed">
                        <!-- Initial Content -->
                        <p class="text-xl font-medium text-gray-900 mb-6 drop-cap">
                            We often take our planet for granted. The clean air, the fresh water, and the green forests seem infinite, but the reality is starkly different. Climate change is no longer a distant threat; it is happening right now.
                        </p>
                        <p class="mb-6">
                            Our oceans are filling with plastic, our forests are burning, and our wildlife is disappearing at an alarming rate. But it's not too late to act. Small changes in our daily lives can lead to a massive global impact.
                        </p>
                        <h3 class="text-2xl font-bold text-gray-900 mt-8 mb-4">Why We Need to Act Now</h3>
                        <p class="mb-6">
                            The Earth provides us with everything we need to survive. By protecting it, we are protecting our own future. Sustainable living isn't just a trend; it's a necessity. From reducing single-use plastics to conserving water, every action counts.
                        </p>
                        <ul class="list-disc pl-6 mb-8 space-y-2 bg-stone-50 p-6 rounded-xl border border-stone-200">
                            <li><strong>Reduce:</strong> Buy less, waste less.</li>
                            <li><strong>Reuse:</strong> Find new ways to use old items.</li>
                            <li><strong>Recycle:</strong> Properly dispose of waste.</li>
                        </ul>
                        <p>
                            Let's pledge today to do our part. Whether it's planting a tree or simply switching off the lights when not in use, let's save our home. Because there is no Planet B.
                        </p>
                    </div>
                </article>

                <!-- Comments Section -->
                <section class="mt-12" id="discussion">
                    <h3 class="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                        Discussion 
                        <span class="text-sm font-normal text-white bg-green-600 px-2 py-0.5 rounded-full" id="comment-count">0</span>
                    </h3>

                    <!-- Comment Form -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-200 mb-8">
                        <h4 class="font-bold text-xs text-stone-500 mb-4 uppercase tracking-wide">Leave a Reply</h4>
                        <form onsubmit="handlePostComment(event)" class="space-y-4">
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <input type="text" id="comment-name" required class="w-full px-4 py-2 bg-stone-50 border border-stone-200 rounded-lg focus:ring-2 focus:ring-green-500 outline-none transition" placeholder="Your Name">
                            </div>
                            <textarea id="comment-text" required rows="3" class="w-full px-4 py-2 bg-stone-50 border border-stone-200 rounded-lg focus:ring-2 focus:ring-green-500 outline-none transition resize-none" placeholder="What are your thoughts?"></textarea>
                            <button type="submit" class="bg-green-600 text-white px-6 py-2.5 rounded-lg font-bold hover:bg-green-700 transition shadow-md w-full sm:w-auto">
                                Post Comment
                            </button>
                        </form>
                    </div>

                    <!-- Comments List -->
                    <div id="comments-list" class="space-y-4">
                        <div class="text-center py-8">
                            <div class="inline-block animate-spin rounded-full h-6 w-6 border-4 border-stone-200 border-t-green-600"></div>
                        </div>
                    </div>
                </section>
            </main>

            <!-- RIGHT COLUMN: Sidebar (Trending) -->
            <aside class="lg:col-span-4 space-y-8 order-2" id="trending-section">
                
                <!-- Trending Posts Widget -->
                <div class="bg-white rounded-2xl shadow-sm border border-stone-100 overflow-hidden sticky top-24">
                    <div class="bg-stone-900 px-6 py-4 flex items-center justify-between">
                        <h3 class="font-bold text-white flex items-center gap-2 text-sm uppercase tracking-wider">
                            <i class="ph-bold ph-trend-up text-green-400"></i> Trending Now
                        </h3>
                    </div>
                    
                    <div class="p-0 max-h-[70vh] overflow-y-auto trending-scroll" id="trending-list">
                        <!-- Loading State -->
                        <div class="p-8 text-center">
                             <div class="inline-block animate-spin rounded-full h-6 w-6 border-4 border-stone-200 border-t-green-600"></div>
                             <p class="text-stone-400 text-xs mt-2">Loading trends...</p>
                        </div>
                    </div>

                    <div class="bg-stone-50 p-3 text-center border-t border-stone-100">
                        <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="text-xs font-bold text-stone-500 hover:text-green-700 uppercase tracking-wide flex items-center justify-center gap-1">
                            Back to Top <i class="ph-bold ph-arrow-up"></i>
                        </button>
                    </div>
                </div>

                <!-- Ad / Promo Placeholder -->
                <div class="bg-green-50 rounded-2xl p-6 text-center border border-green-100 hidden lg:block">
                    <i class="ph-duotone ph-tree text-4xl text-green-600 mb-2"></i>
                    <h4 class="font-bold text-green-900">Plant a Tree</h4>
                    <p class="text-sm text-green-700 mt-1 mb-4">Join our initiative to plant 1 million trees this year.</p>
                    <button class="bg-green-600 text-white text-xs font-bold px-4 py-2 rounded-lg hover:bg-green-700 transition shadow-sm">Learn More</button>
                </div>

            </aside>

        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-stone-900 text-stone-400 py-12 text-center mt-auto border-t-4 border-green-600">
        <div class="max-w-4xl mx-auto px-4">
            <p class="mb-4 font-serif italic text-lg text-stone-300">"The Earth does not belong to us: we belong to the Earth."</p>
            <p class="text-sm">© 2026 Prathamer's Blog. Powered by Cloud Technology.</p>
        </div>
    </footer>

    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-5 right-5 bg-stone-800 text-white px-5 py-3 rounded-lg shadow-xl transform translate-y-20 opacity-0 transition-all duration-300 z-50 flex items-center gap-3 border-l-4 border-green-500">
        <i class="ph-bold ph-check-circle text-green-400"></i>
        <span id="toast-msg">Success</span>
    </div>

    <!-- Firebase Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getDatabase, ref, push, onValue, runTransaction, serverTimestamp, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

        // Config
        const firebaseConfig = {
            apiKey: "AIzaSyCZNXuHg15Ns3ydQ8yd6VOjm58sjfH2dUE",
            authDomain: "prathamersblog.firebaseapp.com",
            databaseURL: "https://my-blog-server-ed755-default-rtdb.firebaseio.com/",
            projectId: "prathamersblog",
            storageBucket: "prathamersblog.firebasestorage.app",
            messagingSenderId: "632179269904",
            appId: "1:632179269904:web:64e4beb224ad1ed79e4595",
            measurementId: "G-HSW8MLPQV8"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Constants & State
        const badWords = ['fuck', 'shit', 'bitch', 'asshole', 'idiot', 'stupid', 'sex', 'porn'];
        let activePostId = 'save-earth-001'; 
        let allPosts = []; // Local cache
        let unsubscribeViews = null;
        let unsubscribeComments = null;

        // --- 1. Dynamic Post Loading Logic ---
        
        // This function switches the content of the page to a new post
        window.loadPost = function(id) {
            const safeId = String(id);
            activePostId = safeId;
            
            // Find post in cache
            const post = allPosts.find(p => String(p.id) === safeId);
            
            if (post) {
                // Update DOM
                document.getElementById('article-title').textContent = post.title;
                document.getElementById('article-category').textContent = post.category || 'General';
                document.getElementById('article-image').src = post.image || "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=1600";
                
                // Handle content - fallback to excerpt if full content missing
                const contentEl = document.getElementById('article-content');
                if (post.content) {
                    contentEl.innerHTML = post.content;
                } else {
                    contentEl.innerHTML = `<p class="text-xl font-medium text-gray-900 mb-6 drop-cap">${post.excerpt || 'No preview available.'}</p>`;
                }
                
                document.getElementById('article-author').textContent = post.author || 'Anonymous';
                document.getElementById('article-author-img').src = post.authorImg || `https://ui-avatars.com/api/?name=${post.author || 'User'}&background=random`;
                document.getElementById('article-date').textContent = post.date || new Date().toLocaleDateString();
                
                // Visual feedback
                window.scrollTo({top: 0, behavior: 'smooth'});
                const article = document.getElementById('main-article');
                article.classList.remove('fade-in');
                void article.offsetWidth; // Force reflow
                article.classList.add('fade-in');
            }

            // Reset Listeners for new post
            setupListeners(safeId);
        }

        // Helper to manage Firebase listeners for the active post
        function setupListeners(postId) {
            // Unsubscribe previous listeners if they exist to prevent memory leaks/duplicate calls
            if (typeof unsubscribeViews === 'function') unsubscribeViews();
            if (typeof unsubscribeComments === 'function') unsubscribeComments();

            // 1. View Counter Logic
            const viewCountRef = ref(db, `posts/${postId}/views`);
            
            // Increment view (Transactional)
            runTransaction(viewCountRef, (currentViews) => (currentViews || 0) + 1);
            
            // Listen for view updates
            unsubscribeViews = onValue(viewCountRef, (snapshot) => {
                const views = snapshot.val() || 0;
                const el = document.getElementById('view-counter');
                if(el) el.textContent = views.toLocaleString() + " views";
            });

            // 2. Comments Logic
            const commentsRef = ref(db, 'comments');
            
            unsubscribeComments = onValue(commentsRef, (snapshot) => {
                const data = snapshot.val();
                const list = document.getElementById('comments-list');
                const countEl = document.getElementById('comment-count');
                if(!list) return;
                
                list.innerHTML = '';
                if (!data) {
                    list.innerHTML = '<p class="text-center text-stone-400 italic py-4">No comments yet. Be the first!</p>';
                    if(countEl) countEl.textContent = '0';
                    return;
                }

                const commentsArray = [];
                for (let key in data) commentsArray.push(data[key]);

                // Filter comments for the CURRENT post ID
                const relevantComments = commentsArray
                    .filter(c => String(c.postId) === String(postId))
                    .sort((a, b) => b.timestamp - a.timestamp);

                if(countEl) countEl.textContent = relevantComments.length;

                if (relevantComments.length === 0) {
                    list.innerHTML = '<p class="text-center text-stone-400 italic py-4">No comments yet for this post.</p>';
                }

                relevantComments.forEach(c => {
                    const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(c.author)}&background=random&color=fff&size=64`;
                    const html = `
                        <div class="flex gap-4 animate-fade-in group">
                            <img src="${avatarUrl}" alt="${c.author}" class="w-10 h-10 rounded-full border border-stone-100 shadow-sm flex-shrink-0">
                            <div class="flex-grow">
                                <div class="bg-stone-50 p-4 rounded-xl rounded-tl-none border border-stone-100 group-hover:border-stone-200 transition">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="font-bold text-sm text-gray-900">${c.author}</span>
                                        <span class="text-xs text-stone-400">${c.date}</span>
                                    </div>
                                    <p class="text-gray-700 text-sm leading-relaxed">${c.text}</p>
                                </div>
                            </div>
                        </div>
                    `;
                    list.innerHTML += html;
                });
            });
        }

        // Initialize for the default static post
        const defaultPost = {
            id: 'save-earth-001',
            title: "Save Earth: There is No Planet B",
            category: "Environment",
            image: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-1.2.1&auto=format&fit=crop&w=1600&q=80",
            author: "Prathamer",
            date: "Oct 24, 2023",
            views: 1200, 
            content: document.getElementById('article-content').innerHTML 
        };
        allPosts.push(defaultPost);
        setupListeners(activePostId);

        // --- 3. Comment Submission ---
        window.handlePostComment = async function(e) {
            e.preventDefault();
            const nameInput = document.getElementById('comment-name');
            const textInput = document.getElementById('comment-text');
            const name = nameInput.value.trim();
            const text = textInput.value.trim();

            if (!name || !text) return;
            if (badWords.some(w => (name + " " + text).toLowerCase().includes(w))) {
                alert("Please be respectful. Profanity is not allowed."); return;
            }

            try {
                await push(ref(db, 'comments'), {
                    postId: activePostId, // Use the dynamic current ID
                    author: name,
                    text: text,
                    date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
                    timestamp: Date.now()
                });
                nameInput.value = ''; textInput.value = '';
                showToast("Comment Posted!");
            } catch (err) {
                console.error(err); alert("Failed to post.");
            }
        }

        // --- 4. Trending Posts Logic (Real Data) ---
        const postsRef = ref(db, 'posts');

        onValue(postsRef, (snapshot) => {
            const data = snapshot.val();
            const trendingList = document.getElementById('trending-list');
            if(!trendingList) return;
            
            allPosts = [defaultPost]; // Reset cache, keep default
            
            // Add Harshal Patil's Post
            allPosts.push({
                id: 'harshal-patil-001',
                title: "The Future of Web Development",
                category: "Technology",
                image: "https://images.unsplash.com/photo-1498050108023-c5249f4df085?ixlib=rb-1.2.1&auto=format&fit=crop&w=1600&q=80",
                author: "Harshal Patil",
                date: "Jan 15, 2026",
                views: 850,
                excerpt: "Exploring the latest trends in web development and what lies ahead for developers in 2026.",
                content: `
                    <div class="prose prose-lg prose-stone mx-auto text-gray-700 leading-relaxed">
                        <p class="text-xl font-medium text-gray-900 mb-6 drop-cap">
                            The landscape of web development is changing rapidly. As we move further into the digital age, the tools and technologies we use are becoming more powerful and complex.
                        </p>
                        <p class="mb-6">
                            From AI-assisted coding to serverless architectures, the way we build the web is evolving. In this post, I want to share my thoughts on where we are heading.
                        </p>
                        <h3 class="text-2xl font-bold text-gray-900 mt-8 mb-4">Embracing AI</h3>
                        <p class="mb-6">
                            Artificial Intelligence is no longer just a buzzword. It's a tool that every developer needs to have in their arsenal. Whether it's for generating boilerplate code or optimizing algorithms, AI is here to stay.
                        </p>
                        <p>
                            Stay curious, keep learning, and let's build the future together.
                        </p>
                    </div>`
            });
            
            if (data) {
                for (let key in data) {
                    if (key !== 'save-earth-001') {
                        allPosts.push({ id: key, ...data[key] });
                    }
                }
            }
            
            // If empty (besides default and Harshal), show dummies
            if (allPosts.length === 2) {
                const dummyTopics = [
                     {t: "Future of Green Tech", c: "Tech"}, 
                     {t: "Sustainable Living Guide", c: "Lifestyle"},
                     {t: "Zero Waste Cooking", c: "Food"},
                     {t: "Travel on a Budget", c: "Travel"},
                     {t: "Meditation 101", c: "Health"}
                ];
                dummyTopics.forEach((t, i) => {
                     allPosts.push({
                        id: `dummy-${i}`,
                        title: t.t,
                        category: t.c,
                        views: Math.floor(Math.random() * 400) + 100,
                        excerpt: "This is a sample trending post. Read more to find out about this topic...",
                        image: `https://images.unsplash.com/photo-1518${i}23249-a2f2f0c0f89d?w=800`
                     });
                });
            }

            renderTrending(allPosts);
        });

        function renderTrending(posts) {
            const list = document.getElementById('trending-list');
            list.innerHTML = '';
            
            // Sort by views desc
            const sorted = [...posts].sort((a, b) => (b.views || 0) - (a.views || 0));

            sorted.forEach((p, index) => {
                const titleText = p.title || 'Untitled';
                // Escape ID for onclick
                const safeId = String(p.id);
                const html = `
                    <div onclick="loadPost('${safeId}')" class="flex items-start gap-3 mb-2 group cursor-pointer hover:bg-stone-50 p-3 rounded-xl transition border border-transparent hover:border-stone-100">
                        <span class="text-xl font-black text-stone-200 group-hover:text-green-500 transition leading-none mt-1">#${index + 1}</span>
                        <div>
                            <h4 class="font-bold text-gray-800 text-sm leading-snug mb-1 group-hover:text-green-700 transition line-clamp-2">${titleText}</h4>
                            <div class="flex items-center gap-2 text-[10px] uppercase font-bold text-stone-400">
                                <span>${(p.views || 0).toLocaleString()} views</span>
                                <span>•</span>
                                <span class="text-green-600">${p.category || 'Post'}</span>
                            </div>
                        </div>
                    </div>
                `;
                list.innerHTML += html;
            });
        }

        // --- 5. Search Logic ---
        const searchInput = document.getElementById('search-input');
        if(searchInput) {
            searchInput.addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                const filtered = allPosts.filter(p => p.title && p.title.toLowerCase().includes(term));
                renderTrending(filtered);
            });
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').textContent = msg;
            t.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => t.classList.add('translate-y-20', 'opacity-0'), 3000);
        }

    </script>
</body>
</html>
